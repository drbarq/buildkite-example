steps:
  - label: "Verify Buildkite Directory Structure"
    command:
      - "ls -R"

  - label: "Build Go Application"
    plugins:
      - docker-compose#v3.0.3:
          build: app
    artifact_paths:
      - "hello_binary"

  - wait

  - block: "Pause before entering name"
    prompt: "Please enter your name in the following input step."

  - input: "Enter your name"
    fields:
      - text: "Your name"
        key: "name"
  - label: "Run Script"
    command: script.sh

  - label: "Debug: Check Metadata"
    command: |
      echo "Attempting to retrieve name from metadata..."
      name=$(buildkite-agent meta-data get "name")
      echo "Retrieved name: $name"

  - label: "Set Name Environment Variable"
    command: |
      name=$(buildkite-agent meta-data get "name")
      if [ -z "$name" ]; then
        echo "Error: No name provided"
        exit 1
      fi
      echo "Name set to: $name"

  - label: "Run Hello Binary Inside Docker Container"
    plugins:
      - docker-compose#v3.0.3:
          run: app
          command:
            - "sh"
            - "-c"
            - './hello_binary "$(buildkite-agent meta-data get name)"'
# steps:
#   - label: "Verify Buildkite Directory Structure"
#     command:
#       - "ls -R"

#   - label: "Build Go Application"
#     plugins:
#       - docker-compose#v3.0.3:
#           build: app
#     artifact_paths:
#       - "hello_binary"

#   - wait

#   # - block: "Enter your name"
#   #   prompt: "Please enter your name:"
#   #   key: "username"

#   # Block the pipeline and wait for a manual unblock
#   - block: "Pause before entering name"
#     prompt: "Are you ready to enter your name?"

#   # Input step to capture the user's name
#   - input: "Enter your name"
#     fields:
#       - text: "Your name"
#         key: "name"

#   - label: "Run Hello Binary Inside Docker Container"
#     plugins:
#       - docker-compose#v3.0.3:
#           run: app
#           command: ["./hello_binary", "$(buildkite-agent meta-data get name)"]

# - label: "Run Hello Binary Inside Docker Container"
#   plugins:
#     - docker-compose#v3.0.3:
#         run: app
#         command: ["./hello_binary"]
# steps:
#   - label: "Build Go Application"
#     plugins:
#       - docker-compose#v3.0.3:
#           build: app
#     artifact_paths:
#       - "hello_binary"

#   - wait

#   - block: "Enter your name"
#     prompt: "Please enter your name:"
#     key: "username"

#   - label: "Run Hello Binary Inside Docker Container"
#     plugins:
#       - docker-compose#v3.0.3:
#           run: app
#           command:
#             ["./hello_binary", "$(buildkite-agent meta-data get username)"]
